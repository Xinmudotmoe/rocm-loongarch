From 2d876ed33ee38145ae7b44f3d82a8142a78fd5b8 Mon Sep 17 00:00:00 2001
From: hev <wangrui@loongson.cn>
Date: Fri, 21 Mar 2025 10:15:31 +0800
Subject: [PATCH] [llvm][LoongArch] Changing the default code model from
 `small` to `medium` for 64-bit (#132173)

Link: https://discourse.llvm.org/t/rfc-changing-the-default-code-model-for-loongarch
---
 .../LoongArch/LoongArchTargetMachine.cpp      |   2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/llvm/lib/Target/LoongArch/LoongArchTargetMachine.cpp b/llvm/lib/Target/LoongArch/LoongArchTargetMachine.cpp
index 62b08be5435cd..692392dc2bae0 100644
--- a/llvm/lib/Target/LoongArch/LoongArchTargetMachine.cpp
+++ b/llvm/lib/Target/LoongArch/LoongArchTargetMachine.cpp
@@ -70,7 +70,7 @@ static CodeModel::Model
 getEffectiveLoongArchCodeModel(const Triple &TT,
                                std::optional<CodeModel::Model> CM) {
   if (!CM)
-    return CodeModel::Small;
+    return TT.isArch64Bit() ? CodeModel::Medium : CodeModel::Small;

   switch (*CM) {
   case CodeModel::Small:
